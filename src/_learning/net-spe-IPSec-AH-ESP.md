---
title: "ネットワークスペシャリスト　IPSecのAHとESPの概要と比較"
date: 2024-03-14T09:37:00
jobtitle: ""
linkedinurl: ""
mermaid: true
weight: 7
---

# IPSecのAHとESPの概要と比較

## 概要

IPSec（Internet Protocol Security）は、インターネット上でデータを安全に送受信するためのプロトコル群です。主にAH（Authentication Header）とESP（Encapsulating Security Payload）の2つのプロトコルを使用して、データの安全性を高めます。

### AH（Authentication Header）

- **目的**: データの改ざん防止。
- **特徴**: データに認証ヘッダーを付加して、データの整合性を保証します。しかし、データの秘匿（暗号化）は提供しません。

### ESP（Encapsulating Security Payload）

- **目的**: データの改ざん防止と秘匿。
- **特徴**: データを暗号化して秘匿性を保つと共に、整合性の保証も提供します。

## TCP/UDP Header

- AH : 51(TCP)
- ESP : 50(TCP)
- IKE : 500(UDP)

## パケット構成の違い

| 機能/構成要素       | AH                             | ESP                                       |
|-------------------|-------------------------------|-------------------------------------------|
| **目的**             | データの認証と整合性保証          | データの認証、整合性保証、および秘匿（暗号化）提供 |
| **IPヘッダー**         | あり                          | あり                                      |
| **セキュリティヘッダー** | AHヘッダー（認証情報含む）          | ESPヘッダー                               |
| **ペイロード暗号化**    | なし                          | あり                                      |
| **認証データ**        | パケット全体にわたる           | オプションで提供                          |
| **ペイロード**        | ペイロード（暗号化されず）        | 暗号化されたペイロード                    |
| **トレーラー**         | なし                          | あり（パディング情報等含む）                |

## メッセージ認証の違い

- **AH**: パケット全体にわたってメッセージ認証を提供し、データの改ざんを防ぎますが、秘匿性はありません。
- **ESP**: ペイロードの暗号化とオプションで認証データを提供し、データの秘匿性と改ざん防止の両方を実現します。

総合的に、ESPはAHに比べてより高度なセキュリティ機能を提供し、現代のインターネット通信においてはESPが一般的に推奨される選択肢となっています。

# IPパケット内のESP構成要素の詳細

以下の表は、IPパケットにおけるESPプロトコルの構成要素（ESPヘッダ、IPパケット、ESPトレーラ、ESP認証データ）のバイト長、認証範囲、および暗号化される範囲について説明しています。

| 構成要素       | バイト長 (おおよその値) | 認証範囲                                             | 暗号化範囲                         |
|--------------|---------------------|--------------------------------------------------|------------------------------|
| IPヘッダ       | 20〜60              | 認証されない                                         | 暗号化されない                    |
| ESPヘッダ      | 8                   | 認証される（オプションでESP認証データがある場合）              | 暗号化されない                    |
| IPパケット     | 可変                | 認証される（ESPトレーラとESP認証データを除く）                 | 暗号化される（ESPヘッダ後のデータ）  |
| ESPトレーラ    | 2〜(可変)           | 認証される                                            | 暗号化される                        |
| ESP認証データ  | 0、12、16 など可変     | N/A (自身は認証されるが、認証範囲には含まれない)             | 暗号化されない                    |

## 説明

- **IPヘッダ**: 通常のIP通信で使用されるヘッダです。この部分は暗号化されず、ESPの認証範囲にも含まれません。
- **ESPヘッダ**: ESP処理の開始を示すヘッダです。暗号化はされませんが、認証データが含まれる場合、認証の範囲に含まれます。
- **IPパケット (ESPペイロード)**: 実際のデータが含まれる部分です。このセクション全体が暗号化され、ESPトレーラを除いた部分が認証の範囲に含まれます。
- **ESPトレーラ**: パディングや次のヘッダを指定する情報が含まれます。この部分はデータと共に暗号化され、認証の対象ともなります。
- **ESP認証データ**: パケットの認証を提供するための追加データです。このデータ自体は認証されますが、暗号化されることはありません。また、認証の計算には含まれません。

この構成により、ESPはデータの秘匿性と認証を同時に提供することができます。ただし、IPヘッダは暗号化されないため、送信元と送信先のIPアドレスなど、一部の情報は暗号化されずに送信されます。
