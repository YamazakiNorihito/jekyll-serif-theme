---
title: "ネットワークスペシャリスト　VLAN"
date: 2024-02-29T05:04:00
jobtitle: ""
linkedinurl: ""
mermaid: true
weight: 7
---

# VLANの基本

## VLANとは？

- VLAN（Virtual Local Area Network）は、物理的なネットワークを論理的に分割する技術です。これにより、異なる物理的場所にあるデバイスを同一のネットワークに属させたり、一つの物理的ネットワーク内で複数の仮想ネットワークを作成することができます。

## VLANの重要な点

1. **セキュリティの向上**: ネットワーク内のトラフィックを分割し、異なるグループ間のデータ流れを制限します。
2. **ネットワークパフォーマンスの向上**: ブロードキャストトラフィックを特定のセグメントに限定し、ネットワークの混雑を減少させます。
3. **柔軟なネットワーク設計**: 物理的配置に依存せず、ネットワークを論理的に分割・組織することができます。
4. **コスト削減**: 新しい物理的なネットワーク機器を追加せずに、既存のネットワーク構造内で複数の論理的なネットワークを作成できます。

## VLANのパケット構成

TPIDとTCIが差し込まれる

| 項目 | 説明 | サイズ（バイト） |
|---|---|---|
| 宛先MACアドレス | 受信デバイスのMACアドレス | 6 |
| ソースMACアドレス | 送信デバイスのMACアドレス | 6 |
| タグプロトコル識別子 (TPID) | VLANタグの存在を示す（0x8100） | 2 |
| タグコントロール情報 (TCI) | 優先度情報、DEI/CFI、VLAN IDを含む | 2 |
| イーサタイプ/長さ | ペイロードのタイプまたは長さ | 2 |
| ペイロード（データ） | ユーザーデータ、IPパケットなど | 46-1500 |
| フレームチェックシーケンス (FCS) | エラーチェック用のCRC値 | 4 |

*TCI（Tag Control Information*

| Field          | Size (bits) | Description                              |
|----------------|-------------|------------------------------------------|
| Priority Code Point (PCP) | 3           | フレームの優先度を示す。                 |
| Drop Eligible Indicator (DEI) | 1           | フレームが破棄される可能性を示す。         |
| VLAN Identifier (VID) | 12          | VLANのIDを示す。                          |

## VLANの種類とOSIレイヤー

- **ポートベースVLAN**（静的VLAN）: レイヤー2で動作し、マネージドスイッチが必要。
- **MACアドレスベースVLAN**: レイヤー2で動作し、マネージドスイッチが必要。
- **プロトコルベースVLAN**: レイヤー2で動作し、レイヤー3の情報を使用、マネージドスイッチが必要。
- **IPサブネットベースVLAN**（動的VLAN）: レイヤー3で動作し、レイヤー3スイッチが必要。
- **タグベースVLAN**（IEEE 802.1Q）: レイヤー2で動作し、VLANタギングをサポートするマネージドスイッチが必要。

## VLANとCoS（Class of Service）

- CoSは、ネットワークトラフィックの優先順位を設定する仕組みで、VLAN環境で役立ちます。
- ネットワーク機器は、パケットが持つ「優先度タグ」を見て、どのパケットを優先的に処理すべきかを判断します。
- CoS値はVLANタグの一部として含まれており、Priority Code Point（PCP）という3ビットのフィールドで表されます。

## VLAN間の通信

- VLAN対応スイッチ間では、イーサネットフレームにVLANタグを挿入してトラフィックを区別します。
- VLAN非対応スイッチへのトラフィック転送では、VLANタグを除去（アンタグ）して通常のイーサネットフレームとして送信する必要があります。
- VLANタグ付きトラフィックの取り扱いは、受信側のスイッチの能力と設定に依存します。

## VIDの範囲

VLAN Identifier (VID) の範囲は0から4095までですが、全ての数字がユーザーによる使用に利用できるわけではありません。
具体的には：

VID 0: このVIDは特別な用途であり、VLANタグが存在しないことを示すために使用されます。これは、タグなしフレームに対して予約されています。
VID 1: 通常、デフォルトVLANとして使用されます。ほとんどのスイッチや機器では、初期設定でこのVLANに割り当てられています。
VID 4095: このVIDも特別な用途に予約されており、通常はユーザーによる通常のVLAN割り当てには使用されません。
したがって、ユーザーが実際に使用できるVIDの範囲は 2から4094 までです。この範囲内で任意のVIDを設定し、ネットワーク内で異なるVLANを構成することができます。
