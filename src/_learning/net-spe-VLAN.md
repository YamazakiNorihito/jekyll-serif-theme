---
title: "ネットワークスペシャリスト　VLAN"
date: 2024-02-29T05:04:00
jobtitle: ""
linkedinurl: ""
mermaid: true
weight: 7
tags:
  - VLAN
  - ネットワークセグメンテーション
  - IEEE 802.1Q
  - CoS
  - Virtual LAN
  - Network Specialist
description: "VLAN（Virtual Local Area Network）は、物理ネットワークを論理的に分割して、異なるネットワークセグメントを構築する技術です。これにより、セキュリティの向上やネットワークパフォーマンスの最適化が可能です。VLANは、802.1Qタグを用いてフレームを識別し、TCI（Tag Control Information）に優先度やVLAN IDを含めます。異なる種類のVLAN（ポートベース、タグベース、IPサブネットベースなど）をサポートし、VID（VLAN Identifier）の範囲は2から4094です。"
---

# VLAN の基本

## VLAN とは？

- VLAN（Virtual Local Area Network）は、物理的なネットワークを論理的に分割する技術です。これにより、異なる物理的場所にあるデバイスを同一のネットワークに属させたり、一つの物理的ネットワーク内で複数の仮想ネットワークを作成することができます。

## VLAN の重要な点

1. **セキュリティの向上**: ネットワーク内のトラフィックを分割し、異なるグループ間のデータ流れを制限します。
2. **ネットワークパフォーマンスの向上**: ブロードキャストトラフィックを特定のセグメントに限定し、ネットワークの混雑を減少させます。
3. **柔軟なネットワーク設計**: 物理的配置に依存せず、ネットワークを論理的に分割・組織することができます。
4. **コスト削減**: 新しい物理的なネットワーク機器を追加せずに、既存のネットワーク構造内で複数の論理的なネットワークを作成できます。

## VLAN のパケット構成

TPID と TCI が差し込まれる

| 項目                             | 説明                                | サイズ（バイト） |
| -------------------------------- | ----------------------------------- | ---------------- |
| 宛先 MAC アドレス                | 受信デバイスの MAC アドレス         | 6                |
| ソース MAC アドレス              | 送信デバイスの MAC アドレス         | 6                |
| タグプロトコル識別子 (TPID)      | VLAN タグの存在を示す（0x8100）     | 2                |
| タグコントロール情報 (TCI)       | 優先度情報、DEI/CFI、VLAN ID を含む | 2                |
| イーサタイプ/長さ                | ペイロードのタイプまたは長さ        | 2                |
| ペイロード（データ）             | ユーザーデータ、IP パケットなど     | 46-1500          |
| フレームチェックシーケンス (FCS) | エラーチェック用の CRC 値           | 4                |

_TCI（Tag Control Information_

| Field                         | Size (bits) | Description                        |
| ----------------------------- | ----------- | ---------------------------------- |
| Priority Code Point (PCP)     | 3           | フレームの優先度を示す。           |
| Drop Eligible Indicator (DEI) | 1           | フレームが破棄される可能性を示す。 |
| VLAN Identifier (VID)         | 12          | VLAN の ID を示す。                |

## VLAN の種類と OSI レイヤー

- **ポートベース VLAN**（静的 VLAN）: レイヤー 2 で動作し、マネージドスイッチが必要。
- **MAC アドレスベース VLAN**: レイヤー 2 で動作し、マネージドスイッチが必要。
- **プロトコルベース VLAN**: レイヤー 2 で動作し、レイヤー 3 の情報を使用、マネージドスイッチが必要。
- **IP サブネットベース VLAN**（動的 VLAN）: レイヤー 3 で動作し、レイヤー 3 スイッチが必要。
- **タグベース VLAN**（IEEE 802.1Q）: レイヤー 2 で動作し、VLAN タギングをサポートするマネージドスイッチが必要。

## VLAN と CoS（Class of Service）

- CoS は、ネットワークトラフィックの優先順位を設定する仕組みで、VLAN 環境で役立ちます。
- ネットワーク機器は、パケットが持つ「優先度タグ」を見て、どのパケットを優先的に処理すべきかを判断します。
- CoS 値は VLAN タグの一部として含まれており、Priority Code Point（PCP）という 3 ビットのフィールドで表されます。

## VLAN 間の通信

- VLAN 対応スイッチ間では、イーサネットフレームに VLAN タグを挿入してトラフィックを区別します。
- VLAN 非対応スイッチへのトラフィック転送では、VLAN タグを除去（アンタグ）して通常のイーサネットフレームとして送信する必要があります。
- VLAN タグ付きトラフィックの取り扱いは、受信側のスイッチの能力と設定に依存します。

## VID の範囲

VLAN Identifier (VID) の範囲は 0 から 4095 までですが、全ての数字がユーザーによる使用に利用できるわけではありません。
具体的には：

VID 0: この VID は特別な用途であり、VLAN タグが存在しないことを示すために使用されます。これは、タグなしフレームに対して予約されています。
VID 1: 通常、デフォルト VLAN として使用されます。ほとんどのスイッチや機器では、初期設定でこの VLAN に割り当てられています。
VID 4095: この VID も特別な用途に予約されており、通常はユーザーによる通常の VLAN 割り当てには使用されません。
したがって、ユーザーが実際に使用できる VID の範囲は 2 から 4094 までです。この範囲内で任意の VID を設定し、ネットワーク内で異なる VLAN を構成することができます。
